<!DOCTYPE html>
<html>

<head>
    <meta name="viewport" content="width=device-width" , initial-scale="1.0" />
    <meta charset="utf-8" />
    <title> 隨機分組 </title>
    <style>
        .btn {
            background-color: #ffcccc;
            padding: 5px;
            border-radius: 5px;
            /*圓角*/
            cursor: pointer;
            /*滑鼠游標食指*/
            margin-top: 10px;
        }

        .title {
            margin: 10px;
            text-align: center;
            /* 置中 */
            font-size: 1cm;
        }

        .notClickCss {
            pointer-events: none;
            cursor: not-allowed;
            background-color: #FFF0F5;
            margin-top: 10px;
        }

        .container {
            display: flex;
            /* 使用 Flexbox 來排列 */
            flex-wrap: wrap;
            /* 允許子元素換行 */
            justify-content: center;
            /* 水平居中 */
            align-items: flex-start;
            /* 對齊到父容器的頂部 */
            padding: 10px;
        }

        .box {
            display: flex;
            flex-direction: column;
            /* 垂直排列子元素 */
            align-items: center;
            /* 水平居中對齊 */
            margin: 10px;
            /* 每個 .box 的間距 */
            width: 30%;
            /* 使用百分比寬度 */
            min-width: 200px;
            /* 設定最小寬度 */
            box-sizing: border-box;
            /* 確保 padding 包含在高度和寬度內 */
            height: auto;
            /* 确保容器高度可以自适应内容 */
        }

        /* 媒體查詢：當螢幕寬度小於 600px 時改變佈局 */
        @media (max-width: 600px) {
            .box {
                width: 100%;
                /* 讓每個 box 占滿整個寬度 */
                margin: 5px;
                /* 減少間距 */
            }
        }

        #imgLove {
            display: none;
            max-width: 100%;
            /* 确保图片宽度不会超出父容器 */
            height: auto;
            /* 保持图片原始比例 */
            max-height: 100%;
            /* 确保图片的高度不会超出父容器 */
            object-fit: contain;
            /* 确保图片不会变形且完全显示 */
        }

        .img-container {
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
        }
    </style>
</head>

<body>
    <div class="title">
        隨機分組
    </div>
    <form style="text-align:center;" action="p7-randomized block design.html" method="post">
        <textarea name="" id="text" cols="80" rows="10" style="resize:none" placeholder="✨請輸入名稱✨
✨一行一個名字✨
小雞
小毛
小奇
小青蛙
小熊貓">
小雞
小毛
小奇
小青蛙
小熊貓
</textarea>
        <div>
            <span>目前共輸入</span><span id="displayNameAmount">5</span><span>個名字</span>
        </div>
        <div style="padding:10px;">
            分組數量：<input id="amount" type="number" value="2" step="1" min="2" required>
        </div>
        <div style="padding:10px">
            <span onclick="random()" class="btn" id="notClickable1">隨機分組</span>
            <span onclick="empty()" class="btn" id="notClickable2">清空</span>
        </div>
        <hr>
        <div class="title">
            分組結果
        </div>
        <p></p>
        <div class="container">
            <span class="box">
                <span style="margin-bottom: 10px;">一組一段落呈現</span>
                <textarea name="" id="result" cols="40%" rows="10" style="resize:none"></textarea>
                <span onclick="clone()" class="notClickCss" id="copy">複製結果</span>
            </span>
            <span class="box">
                <span style="margin-bottom: 10px;">一名字一行呈現</span>
                <textarea name="" id="result2" cols="40%" rows="10" style="resize:none"></textarea>
                <span onclick="clone2()" class="notClickCss" id="copy2">複製結果</span>
            </span>
            <span class="box">
                <span style="margin-bottom: 10px;">我對你的愛的呈現</span>
                <div class="img-container">
                    <img src="p7-cat1.jpg" height=10 id="imgLove">
                </div>
                <textarea name="" id="result3" cols="40%" rows="10" style="resize:none"></textarea>
                <span class="notClickCss" id="copy3">複製結果</span>
            </span>
        </div>
    </form>

    <script>
        // console.log(window)

        //即時偵測 "分組數量"如果大於名字數量 則不可按下隨機分組按鈕
        function handleInputEvent1(event) {
            console.log("***********")
            let all = document.querySelector("#text");
            console.log(all.value);
            let amount777 = document.querySelector("#amount");
            console.log(amount777.value)
            // 以換行為分隔 拆分成陣列
            let splitTexts = all.value.split(/\r|\r\n|\n/)
            console.log(splitTexts)
            // \r：回车符（Carriage Return），在旧的Mac系统（OS 9及之前）中常用来表示换行。
            // \n：换行符（Line Feed），在Unix/Linux系统和现代Mac系统（OS X及之后）中常用来表示换行。
            // \r\n：回车符加换行符（Carriage Return + Line Feed），在Windows系统中用于表示换行。
            for (i = 0; i < splitTexts.length; i++) {
                if (splitTexts[i] == '' || splitTexts.indexOf(splitTexts[i]) != i) {
                    splitTexts.splice(i, 1);
                    i--;
                    console.log(splitTexts)
                }
            }
            // if裡的splitTexts.indexOf(splitTexts[i]) != i 即等於下面filter的結果
            // splitTexts = splitTexts.filter(function (element, index, arr) {
            //     return arr.indexOf(element) == index;
            // })
            let rows = splitTexts.length // 共有n個名字
            console.log(rows)
            document.querySelector("#displayNameAmount").innerHTML = rows;


            //number 字串轉數字 聽說if裡面有隱式轉換 只是說顯式轉換為數字有助於避免潛在錯誤
            let inputCheck = parseInt(amount777.value); // 有了 嗚嗚嗚嗚嗚 終於
            // let inputCheck = Number(event.target.value) || 0; // 把 event.target.value用戶輸入的內容 從字串轉為數字 ||0 表示如果找不到NaN則設定為初始值0
            console.log(inputCheck);
            // 補充 event.target 是確定事件發生的位置 也代表触发事件的元素 
            // console.log(event.target); // 自己打開看看結果是什麼 也可以去看DOM筆記

            let notClick = document.querySelector("#notClickable1");
            console.log(rows)
            console.log(inputCheck) // NaN
            // 名字數量<分組數量 || 名字數量<2 || 分組數量<2 || 分組數量=="" 則變更"隨機分組"按鈕的樣式為notClickCss
            if (rows < inputCheck || rows < 2 || inputCheck < 2 || amount777.value == "") {
                console.log("AAAAAAAAAAAAAAAAAAAAAAAAAAA")
                notClick.classList.remove("btn");
                notClick.classList.add("notClickCss");
                // notClick.style = "pointer-events:none;cursor: not-allowed;background-color: #FFF0F5;"
                // notClick.style.pointerEvents = "none";
            } else if (rows >= 2 && rows >= inputCheck) {
                console.log("BBBBBBBBBBBBBBBBBBBBBBBBBB")
                notClick.classList.remove("notClickCss");
                notClick.classList.add("btn");
            }

        }
        // 會去監測id"text"和"amount"的input事件類型變動
        document.getElementById("text").addEventListener("input", handleInputEvent1);
        document.getElementById("amount").addEventListener("input", handleInputEvent1);//✨将 handleInputEvent 函数绑定到 #amount 输入框的 input 事件上。
        //这意味着每当用户在 #amount 输入框中输入内容时，handleInputEvent 函数会被自动调用。
        //这意味着每当用户在 #amount 输入框中输入内容时，瀏覽器會自動傳送 "input" 事件的物件作為參數給 handleInputEvent 函數。
        // 所以function開頭的(參數)一定要寫 要給他一個參數的名字 不能空白()

        function random() {
            let all = document.querySelector("#text");
            // console.log(all.value);
            let amount777 = document.querySelector("#amount");
            // console.log(amount777.value)
            // 以換行為分隔 拆分成陣列
            let splitTexts = all.value.split(/\r|\r\n|\n/)
            console.log(splitTexts)
            for (i = 0; i < splitTexts.length; i++) {
                if (splitTexts[i] == '' || splitTexts.indexOf(splitTexts[i]) != i) {
                    splitTexts.splice(i, 1);
                    i--;
                    console.log(splitTexts)
                }
            }
            console.log(splitTexts)
            let rows = splitTexts.length // 共有n個名字
            console.log(rows)

            // 每組的數量
            // Math.floor 無條件捨去小數(浮點數) 用於無法整除的狀況下無條件進位
            let groupAmount = Math.floor(splitTexts.length / amount777.value) // 分組 除法不等於整數 
            console.log(groupAmount)
            // 隨機打亂陣列順序
            function shuffleArray(splitTexts) {
                return splitTexts.sort(function () { // sort()方法用來對陣列的元素進行排序，它接受一個比較函數來決定元素之間的順序。
                    return 0.5 - Math.random();  // function() { return 0.5 - Math.random(); }：這是一個匿名函數，傳遞給 sort() 作為比較函數。這個函數沒有名稱，當 sort() 方法需要比較兩個元素時，它會調用這個匿名函數。
                });
            }
            // 將shuffleArray函數簡化成箭頭函數
            // function shuffleArray(splitTexts) {
            //     return splitTexts.sort(() => 0.5 - Math.random());
            // }
            //再繼續簡化
            // let shuffleArray = splitTexts => splitTexts.sort(() => 0.5 - Math.random());
            console.log(shuffleArray(splitTexts));
            // 隨機打亂陣列順序 用箭頭函數的話長這樣
            // let shuffleArray = (splitTexts) => splitTexts.sort(() => 0.5 - Math.random());
            let final = shuffleArray(splitTexts);
            let finalArr = []
            function greet() {
                let breakCount = 0;
                for (i = 0; i < amount777.value; i++) {
                    breakCount = 0;
                    for (j = 0; j < groupAmount; j++) {
                        if (breakCount >= groupAmount) {
                            break;
                        }
                        let temp = "第" + (i + 1) + "組：";
                        let temp2 = final[j];
                        breakCount += 1;
                        finalArr.push(temp);
                        finalArr.push(temp2 + "、");
                        final.splice(j, 1);
                        j--;
                    }
                }
                console.log(finalArr);
                return finalArr;
            }
            greet();
            let first;
            let tpArr = [];
            console.log(final)
            for (j = 0; j < finalArr.length; j++) {
                let regex = /第\d+組：/; // \d表任意數字
                if (regex.test(finalArr[j])) {
                    tpArr.push(j)
                }
            }
            for (i = 0; i < final.length; i++) {
                finalArr.splice(tpArr[i] + 2, 0, final[i] + "、");
                console.log(finalArr)
            }
            let finalArrSet = [...new Set(finalArr)].join('');
            // console.log(finalArrSet);
            document.getElementById('result').value = finalArrSet
            // 接下來想辦法換行 
            // 用迴圈+搜尋 找出字串"第"的位置 然後插入\n使換行 
            let indexArr = []
            let temps = finalArrSet;
            let q = 2;
            while (q < finalArrSet.length) {
                console.log(temps)
                console.log(q)
                let indexfinal = temps.indexOf("第", q);
                console.log(indexfinal)
                if (q != 2 && indexfinal != -1) {
                    if (indexfinal != -1 && indexArr.includes(indexfinal) == false) {
                        console.log(indexfinal);
                        indexArr.push(indexfinal + 1);
                        console.log(indexArr);
                        function insertStr(soure, start, newStr) {
                            return temps.slice(0, indexfinal) + "\n" + temps.slice(indexfinal);
                        }
                        insertStr(temps, indexfinal, "\n");
                        console.log(insertStr(temps, indexfinal, "\n"));

                    }
                } else if (indexfinal != -1 && indexArr.includes(indexfinal) == false) {
                    console.log(indexfinal);
                    indexArr.push(indexfinal);
                    console.log(indexArr);
                    function insertStr(soure, start, newStr) {
                        return finalArrSet.slice(0, indexfinal) + "\n" + finalArrSet.slice(indexfinal);
                    }
                    insertStr(finalArrSet, indexfinal, "\n");
                    console.log(insertStr(finalArrSet, indexfinal, "\n"));
                }
                temps = insertStr(finalArrSet, indexfinal, "\n")
                if (indexArr.length == amount777.value - 1) {
                    break;
                }
                q = indexfinal + 2;
            }
            console.log(temps)
            // 去掉每組最後一個名字後面的頓號 並多加上一個換行 
            temps = temps.replace(/、\n/g, '\n\n'); // 全局搜索符合"、\n"的字串 並替換為"\n\n"
            // // 讓整個字串行末的頓號刪除
            temps = temps.replace(/、$/gm, '');

            // 正則表達式
            // /$/ 會匹配每一行的結尾 /、$/會匹配行末的頓號字符串 【''】代表刪除
            // temps = temps.replace(/、$/,''); // ✨ /、$/ 會匹配整個字串的最後符合"、"的字串 並刪除
            // temps = temps.replace(/、$/m,''); // ✨ /、$/m 會匹配字串中 第一個找到的"、"字串 並刪除
            // temps = temps.replace(/、$/gm,''); // ✨ /、$/gm 會匹配字串中 全局搜索每一行行末符合"、"的字串 並刪除

            // 去掉每組最後一個名字後面的頓號 並多加上一個換行 此方法不可行的原因
            // replace 會"返回一個新字串" 不會改變原字串
            // .replace('a','b') 只會替換第一個找到的'a'替換為'b' 不會全局搜索 無論i值是哪個位置的頓號 都只會替換掉第一個位置的頓號
            // replaceAll('a','b') 則可替換掉所有找到的'a'
            // 真正的undefined 不會被偵測為字串的undefined
            // for (let i = 0; i < temps.length; i++) {
            //     if (temps[i] + temps[i + 1] == "、\n") {
            //         // 把頓號替換成換行
            //         temps = temps.replace(temps[i], "\n");
            //         console.log(temps)
            //     } else if (temps[i] + temps[i + 1] == "、undefined") {
            //         // 把頓號刪掉
            //         temps = temps.replace(temps[i], "");
            //         console.log(temps)
            //     }
            // }
            document.getElementById('result').value = temps;
            handleInputEvent3();

            // 另外一個顯示方式 一行一個名字呈現
            for (let i = 0; i < temps.length; i++) {
                if (temps[i] == "、") {
                    // 把頓號刪除
                    temps = temps.replace(temps[i], "\n");
                    console.log(temps)
                } else if (temps[i] == "：") {
                    // 把冒號後面插入換行
                    function insertStr(str, index, newStr) {
                        return str.slice(0, index + 1) + newStr + str.slice(index + 1)
                    }
                    temps = insertStr(temps, i, "\n")
                    console.log(temps)
                }
            }
            document.getElementById('result2').value = temps;
            handleInputEvent3Copy2();

            // 在js中移除html的標籤
            if (document.querySelector("#copy3").innerHTML == "複製結果") {
                document.querySelector("#result3").remove();
                let img = document.querySelector("#imgLove");
                img.style.display = "block";
                let catText = document.querySelector("#copy3")
                catText.innerHTML = "✨因為貓貓可愛所以分享給你(❁´◡`❁)✨"
                catText.style.background = "#FFFF00"
            }
            function changeImg() {
                // 產生1-6隨機的數字 
                // Math.random() 生成 0 到 1 之間的浮點數（不包含 1），乘以 6 之後的範圍為 0 到 5.999...。使用 Math.ceil() 可以將它向上取整，得到 1 到 6 之間的整數。
                let num = Math.ceil(Math.random() * 6);
                document.querySelector("#imgLove").src = "p7-cat" + num + ".jpg";
            };
            changeImg();
        }

        function handleInputEvent2(event) {
            let all = document.querySelector("#text");
            let notClick2 = document.querySelector("#notClickable2")
            if (all.value == "") {
                notClick2.classList.remove("btn");
                notClick2.classList.add("notClickCss");
                // notClick.style.pointerEvents = "none";
            } else {
                notClick2.classList.remove("notClickCss");
                notClick2.classList.add("btn");
            }
        }
        document.querySelector("#text").addEventListener("input", handleInputEvent2);


        function empty() {
            let all = document.querySelector("#text");
            let notClick1 = document.querySelector("#notClickable1")
            if (confirm(("確定要清空?!...?!")) == true) {
                all.value = "";
                handleInputEvent2();
                handleInputEvent1();
            }
        }

        function handleInputEvent3(event) {
            let all = document.querySelector("#result");
            let notClick3 = document.querySelector("#copy")
            if (all.value == "") {
                notClick3.classList.remove("btn");
                notClick3.classList.add("notClickCss");
                // notClick3.style = "notClickCss";
            } else {
                notClick3.classList.remove("notClickCss");
                notClick3.classList.add("btn");
            }
        }
        document.querySelector("#result").addEventListener("input", handleInputEvent3);

        function handleInputEvent3Copy2(event) {
            let all = document.querySelector("#result2");
            let notClick3 = document.querySelector("#copy2")
            if (all.value == "") {
                notClick3.classList.remove("btn");
                notClick3.classList.add("notClickCss");
            } else {
                notClick3.classList.remove("notClickCss");
                notClick3.classList.add("btn");
            }
        }
        document.querySelector("#result2").addEventListener("input", handleInputEvent3Copy2);

        function clone() {
            let btnCopy = document.querySelector("#result")
            // console.log(btnCopy)
            btnCopy.select(); // 選取
            document.execCommand('copy'); // copy複製 cut剪下 paste貼上
            alert("複製成功");
        }

        function clone2() {
            let btnCopy = document.querySelector("#result2")
            // console.log(btnCopy)
            btnCopy.select(); // 選取
            document.execCommand('copy'); // copy複製 cut剪下 paste貼上
            alert("複製成功");
        }

    </script>

</body>

</html>
<!-- form 表單-->
<!-- action 告知HTML這個區塊的form 要將資料傳到哪個檔案去(後端之類的)-->
<!-- method 提交資料的方式有兩種 post(信封+信紙):文件或敏感資料 get(明信片):會將資料附加在網址上,不安全-->

<!-- textarea 多行文字輸入標籤-->
<!-- name屬性 ?-->
<!-- cols屬性 水平欄位的字元數 預設20個字元-->
<!-- rows屬性 表行數 rows=""(預設兩行) 可用CSS或JS使自動擴展-->
<!-- 多行輸入框的預設值直接打在textarea標籤內文的位置-->

<!-- input 文字輸入-->
<!-- type number指定類型為數字類型(含有上下箭頭)  button指定為按鈕-- text指定為文字框> -->
<!-- value 預設值-->
<!-- step 數值差(每次增減差)-->
<!-- min 最小值-->
<!-- max 最大值-->
<!-- required 規定此欄位必填-->
<!-- 其他 name 自訂提交的name值 ?-->

<!-- button寫法-->
<!--
        <span onclick="clear()">清空</span> 
        <input onclick="clear()" type="button" value="清空" />
        <button onclick="clear()">清空</button> 
        -->

<!-- sort()方法 -->
<!-- 用來對陣列的元素進行排序，它接受一個比較函數來決定元素之間的順序。-->
<!-- 當你對一個陣列使用sort()方法時 它會依次比較陣列中的每一對元素 -->
<!-- 比較時使用比較函數 -->
<!-- 比較函數return的值(返回值)如果是正數：將前面的元素移到後面 負數or零(這兩者其實有細微差異,但大抵結果相同)：不交換順序 -->
<!-- 是按照陣列順序比較，但不一定是相鄰元素比較-->

<!-- Math.random() -->
<!-- "隨機生成"一個0(包含)到1(不包含)之間的符點數(小數) -->

<!--打亂陣列的另一個方法?? 待研究-->
<!--
// console.log(splitTexts)
//打亂陣列的函數
// function shuffleArray(splitTexts) {
//     let currentIndex = splitTexts.length //當前處理的索引
//     let randomIndex;
//     while (currentIndex !== 0) {
//         randomIndex = Math.floor(Math.random() * currentIndex);
//         currentIndex--;

//         [splitTexts[currentIndex], splitTexts[randomIndex]] = [splitTexts[randomIndex], splitTexts[currentIndex]];
//     }
//     return splitTexts;
// }
// console.log(splitTexts)
-->

<!-- textarea readonly 不可在文字框輸入-->

<!-- js裡修改CSS屬性的方式
範例1：notClick2.style = "pointer-events:none;cursor: not-allowed;background-color: #FFF0F5;" 
範例1注意事項：此方法會覆蓋原本的CSS樣式、只能直接賦值不可套入CSS選擇器
範例2：
notClick3.classList.remove("notClickCss");
notClick3.classList.add("btn"); -->